<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>SDERM AI - Scan My Skin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html { scroll-behavior: smooth; }
    .nav-scrolled {
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(12px);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body class="font-sans text-gray-900 bg-gray-50">
  <!-- Nav omitted for brevity; keep as in your original -->

  <!-- Header -->
  <section class="pt-24 pb-16 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto text-center">
      <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-6">Skin Analysis Upload</h1>
      <p class="text-lg text-gray-600 mb-8">
        Upload a clear image of your skin concern. AI will run and immediately give you a result.
        No one, including us, is able to view your data. All data is deleted immediately after AI analyzes.
      </p>
      <button id="request-demo-btn" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
        Open Uploader
      </button>
    </div>
  </section>

  <!-- Modal -->
  <div id="demo-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl p-8 max-w-lg w-full mx-4 transform transition-all duration-300 max-h-[90vh] overflow-y-auto">
      <div class="text-center">
        <h3 class="text-2xl font-bold mb-4">Upload Your Skin Image</h3>

        <form id="demo-form" class="space-y-4 text-left">
          <!-- Name, Email, Phone, Additional Info Inputs -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
            <input name="name" type="text" required placeholder="Enter your full name"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email Address *</label>
            <input name="email" type="email" required placeholder="Enter your email"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number (Optional)</label>
            <input name="phone" type="tel" placeholder="Enter your phone number"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Additional Information (Optional)</label>
            <textarea name="additionalInfo" rows="3" placeholder="Any additional details…"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea>
          </div>

          <!-- Upload -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Upload Skin Image *</label>
            <div id="upload-area" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-400 transition-colors">
              <input type="file" id="image-upload" accept="image/*" required class="hidden">
              <div id="upload-content">
                <p class="text-gray-600 mb-1">Click to upload or drag and drop</p>
                <p class="text-sm text-gray-500">PNG, JPG, JPEG up to 10MB</p>
              </div>
              <div id="image-preview" class="hidden">
                <img id="preview-img" class="max-w-full max-h-32 mx-auto rounded-lg mb-2" alt="preview">
                <p id="file-name" class="text-sm text-gray-600"></p>
                <button type="button" id="remove-image" class="text-red-500 text-sm hover:text-red-700">Remove</button>
              </div>
            </div>
          </div>

          <!-- Run AI -->
          <div class="flex items-center justify-between gap-4">
            <button type="button" id="run-ai" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition">
              Run AI Analysis
            </button>
          </div>
          <div id="ai-result" class="hidden mt-4 border border-green-200 bg-green-50 rounded-lg p-4 text-sm">
            <div class="font-semibold mb-1">AI Result</div>
            <div id="ai-result-text" class="text-gray-800">Processing…</div>
          </div>

          <!-- Submit / Cancel -->
          <div class="flex space-x-4 pt-2">
            <button type="submit" class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
              Submit for Analysis
            </button>
            <button type="button" id="close-modal" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-400 transition">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // --- UI Elements ---
    const modal = document.getElementById('demo-modal');
    const requestDemoBtn = document.getElementById('request-demo-btn');
    const closeModalBtn = document.getElementById('close-modal');
    const demoForm = document.getElementById('demo-form');
    const uploadArea = document.getElementById('upload-area');
    const imageUpload = document.getElementById('image-upload');
    const uploadContent = document.getElementById('upload-content');
    const imagePreview = document.getElementById('image-preview');
    const previewImg = document.getElementById('preview-img');
    const fileName = document.getElementById('file-name');
    const removeImage = document.getElementById('remove-image');
    const runAiBtn = document.getElementById('run-ai');
    const aiBox = document.getElementById('ai-result');
    const aiText = document.getElementById('ai-result-text');

    // --- Constants ---
    const API_URL = '/api/predict'; // Vercel serverless function

    // --- Modal ---
    function openModal(){ modal.classList.remove('hidden'); document.body.style.overflow = 'hidden'; }
    function closeModal(){ modal.classList.add('hidden'); document.body.style.overflow = 'auto'; resetForm(); }
    function resetForm(){
      demoForm.reset();
      uploadContent.classList.remove('hidden');
      imagePreview.classList.add('hidden');
      uploadArea.classList.remove('border-green-400','bg-green-50');
      uploadArea.classList.add('border-gray-300');
      aiBox.classList.add('hidden');
    }
    requestDemoBtn.addEventListener('click', openModal);
    closeModalBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'&&!modal.classList.contains('hidden')) closeModal(); });

    // --- File Upload ---
    uploadArea.addEventListener('click', ()=> imageUpload.click());
    uploadArea.addEventListener('dragover', (e)=> { e.preventDefault(); uploadArea.classList.add('border-blue-400','bg-blue-50'); });
    uploadArea.addEventListener('dragleave', (e)=> { e.preventDefault(); uploadArea.classList.remove('border-blue-400','bg-blue-50'); });
    uploadArea.addEventListener('drop', (e)=> {
      e.preventDefault(); uploadArea.classList.remove('border-blue-400','bg-blue-50');
      if(e.dataTransfer.files.length) handleImageUpload(e.dataTransfer.files[0]);
    });
    imageUpload.addEventListener('change', (e)=> { if(e.target.files.length) handleImageUpload(e.target.files[0]); });

    function handleImageUpload(file){
      if(!file.type.startsWith('image/')) return alert('Please upload an image file');
      if(file.size>10*1024*1024) return alert('File size must be less than 10MB');

      const reader = new FileReader();
      reader.onload = e=>{
        previewImg.src=e.target.result;
        fileName.textContent=file.name;
        uploadContent.classList.add('hidden');
        imagePreview.classList.remove('hidden');
        uploadArea.classList.remove('border-gray-300');
        uploadArea.classList.add('border-green-400','bg-green-50');
      };
      reader.readAsDataURL(file);
    }

    removeImage.addEventListener('click',(e)=>{
      e.stopPropagation();
      imageUpload.value='';
      uploadContent.classList.remove('hidden');
      imagePreview.classList.add('hidden');
      uploadArea.classList.remove('border-green-400','bg-green-50');
      uploadArea.classList.add('border-gray-300');
    });

    // --- Submit Form (Cloudinary/demo) ---
    demoForm.addEventListener('submit', async e=>{
      e.preventDefault();
      if(!imageUpload.files.length) return alert('Please upload an image for analysis');
      const submitBtn=e.target.querySelector('button[type="submit"]');
      const original=submitBtn.textContent;
      submitBtn.textContent='Uploading image...';
      submitBtn.disabled=true;
      try {
        const fd=new FormData(demoForm);
        const name=fd.get('name'), email=fd.get('email'), phone=fd.get('phone')||'', info=fd.get('additionalInfo')||'';
        const userData={ name,email,phone,additionalInfo:info,submittedAt:new Date().toISOString() };
        // Example: Cloudinary upload stub
        // await uploadToCloudinary(imageUpload.files[0], userData);

        alert('Thanks! Your image has been submitted.');
        closeModal();
      } catch(err){ console.error(err); alert('Error submitting'); submitBtn.textContent=original; submitBtn.disabled=false; }
    });

    // --- Run AI Analysis ---
    runAiBtn.addEventListener('click', async ()=>{
      if(!imageUpload.files.length) return alert('Please upload an image first');
      runAiBtn.disabled=true;
      const original=runAiBtn.textContent;
      runAiBtn.textContent='Analyzing…';
      aiBox.classList.remove('hidden');
      aiText.textContent='Running model…';

      try {
        const form=new FormData();
        form.append('file', imageUpload.files[0]);

        const res=await fetch(API_URL,{ method:'POST', body:form });
        if(!res.ok) throw new Error('Server error');
        const data=await res.json();

        const best=data.best;
        const lines=[`Top prediction: ${best.label} (${(best.confidence*100).toFixed(1)}%)`];
        if(data.top_labels && data.top_labels.length>1){
          for(let i=1;i<data.top_labels.length;i++){
            lines.push(`${i+1}) ${data.top_labels[i]} (${(data.top_confidences[i]*100).toFixed(1)}%)`);
          }
        }
        aiText.innerHTML=lines.join('<br>');
      } catch(err){ console.error(err); aiText.textContent='Error running AI analysis. Server may be down.'; }
      finally{ runAiBtn.textContent=original; runAiBtn.disabled=false; }
    });
  </script>
</body>
</html>
